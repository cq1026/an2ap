<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antigravity Console</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    animation: {
                        'fade-in': 'fadeIn 0.2s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(10px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #fafafa;
        }

        .dark body,
        body.dark {
            background-color: #18181b;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #e4e4e7;
            border-radius: 3px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #3f3f46;
        }
    </style>
</head>

<body class="text-zinc-900 antialiased h-screen flex flex-col overflow-hidden">

    <div id="root" class="h-full flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, createContext, useContext } = React;

        // ==================== Mock Data ====================
        const INITIAL_TOKENS = [
            {
                refresh_token: "1//04A..._MOCK_REFRESH_TOKEN_1",
                access_token_suffix: "...aB9x",
                projectId: "antigravity-prod-001",
                email: "dev@company.com",
                enable: true,
                expires_in: 3599,
                timestamp: Date.now() - 1800000
            },
            {
                refresh_token: "1//09B..._MOCK_REFRESH_TOKEN_2",
                access_token_suffix: "...kL2m",
                projectId: "test-env-x99",
                email: "tester@gmail.com",
                enable: true,
                expires_in: 1200,
                timestamp: Date.now() - 3600000
            },
            {
                refresh_token: "1//08C..._MOCK_REFRESH_TOKEN_3",
                access_token_suffix: "...99Op",
                projectId: "legacy-project-v1",
                email: null,
                enable: false,
                expires_in: 3599,
                timestamp: Date.now() - 86400000
            },
        ];

        // æ­£ç¡®çš„é¢åº¦æ•°æ®ï¼šæŒ‰æ¯ä¸ªæ¨¡å‹å•ç‹¬æ˜¾ç¤º
        const MOCK_QUOTA_MODELS = {
            'claude-sonnet-4-5': { remaining: 0.75, resetTime: '12-09 08:00' },
            'claude-sonnet-4-5-thinking': { remaining: 0.45, resetTime: '12-09 08:00' },
            'gemini-2.5-pro': { remaining: 0.92, resetTime: '12-09 00:00' },
            'gemini-2.5-flash': { remaining: 0.88, resetTime: '12-09 00:00' },
            'gemini-2.0-flash-exp': { remaining: 0.65, resetTime: '12-09 00:00' },
            'gpt-oss-120b-medium': { remaining: 0.15, resetTime: '12-09 12:00' }
        };

        const INITIAL_CONFIG = {
            port: 8045, host: "0.0.0.0", maxRequestSize: "50mb",
            temp: 1.0, topP: 0.85, topK: 50, maxTokens: 8096,
            timeout: 180000, proxy: "", skipProjectIdFetch: true,
            systemInstruction: "", apiKey: "sk-text"
        };

        // ==================== Icons ====================
        const Icon = ({ name, size = 18, className = "" }) => {
            const icons = {
                Zap: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></svg>,
                LayoutGrid: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="7" height="7" x="3" y="3" rx="1" /><rect width="7" height="7" x="14" y="3" rx="1" /><rect width="7" height="7" x="14" y="14" rx="1" /><rect width="7" height="7" x="3" y="14" rx="1" /></svg>,
                Settings: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" /><circle cx="12" cy="12" r="3" /></svg>,
                LogOut: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" /><polyline points="16 17 21 12 16 7" /><line x1="21" x2="9" y1="12" y2="12" /></svg>,
                Plus: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14" /><path d="M12 5v14" /></svg>,
                RefreshCw: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M8 16H3v5" /></svg>,
                Trash2: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></svg>,
                BarChart3: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 3v18h18" /><path d="M18 17V9" /><path d="M13 17V5" /><path d="M8 17v-3" /></svg>,
                ExternalLink: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" x2="21" y1="14" y2="3" /></svg>,
                X: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18" /><path d="m6 6 12 12" /></svg>,
                Check: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12" /></svg>,
                Clock: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></svg>,
                Sun: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="4" /><path d="M12 2v2" /><path d="M12 20v2" /><path d="m4.93 4.93 1.41 1.41" /><path d="m17.66 17.66 1.41 1.41" /><path d="M2 12h2" /><path d="M20 12h2" /><path d="m6.34 17.66-1.41 1.41" /><path d="m19.07 4.93-1.41 1.41" /></svg>,
                Moon: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" /></svg>
            };
            return icons[name] || null;
        };

        // ==================== Toast Context ====================
        const ToastContext = createContext();

        const ToastProvider = ({ children }) => {
            const [toasts, setToasts] = useState([]);

            const addToast = (message, type = 'info') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, type }]);
                setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 3000);
            };

            return (
                <ToastContext.Provider value={{ addToast }}>
                    {children}
                    <div className="fixed top-4 right-4 z-50 space-y-2">
                        {toasts.map(toast => (
                            <div key={toast.id} className={`animate-slide-up flex items-center gap-3 px-4 py-3 rounded-lg shadow-lg border text-sm ${toast.type === 'success' ? 'bg-emerald-50 border-emerald-200 text-emerald-800 dark:bg-emerald-900/30 dark:border-emerald-800 dark:text-emerald-400' :
                                toast.type === 'error' ? 'bg-red-50 border-red-200 text-red-800 dark:bg-red-900/30 dark:border-red-800 dark:text-red-400' :
                                    toast.type === 'warning' ? 'bg-amber-50 border-amber-200 text-amber-800 dark:bg-amber-900/30 dark:border-amber-800 dark:text-amber-400' :
                                        'bg-white border-zinc-200 text-zinc-800 dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-200'
                                }`}>
                                {toast.type === 'success' && <Icon name="Check" size={16} />}
                                <span className="font-medium">{toast.message}</span>
                            </div>
                        ))}
                    </div>
                </ToastContext.Provider>
            );
        };

        const useToast = () => useContext(ToastContext);

        // ==================== UI Components ====================
        const Button = ({ children, variant = 'primary', size = 'md', className = "", onClick, isLoading, disabled }) => {
            const variants = {
                primary: "bg-zinc-900 text-white hover:bg-zinc-800 dark:bg-zinc-100 dark:text-zinc-900 dark:hover:bg-zinc-200 shadow-sm border border-transparent",
                secondary: "bg-white text-zinc-900 border border-zinc-200 hover:bg-zinc-50 dark:bg-zinc-800 dark:text-zinc-200 dark:border-zinc-700 dark:hover:bg-zinc-700 shadow-sm",
                danger: "bg-white text-red-600 border border-zinc-200 hover:bg-red-50 hover:border-red-200 dark:bg-zinc-800 dark:text-red-400 dark:border-zinc-700 dark:hover:bg-red-900/20 dark:hover:border-red-800",
                ghost: "bg-transparent text-zinc-600 hover:bg-zinc-100 dark:text-zinc-400 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-zinc-200",
            };
            const sizes = { sm: "h-8 px-3 text-xs", md: "h-9 px-4 text-sm", lg: "h-10 px-6 text-base", icon: "h-8 w-8 p-0" };
            return (
                <button
                    className={`inline-flex items-center justify-center font-medium transition-colors rounded-md disabled:opacity-50 disabled:cursor-not-allowed ${variants[variant]} ${sizes[size]} ${className}`}
                    onClick={onClick} disabled={disabled || isLoading}
                >
                    {isLoading && <span className="w-3 h-3 border-2 border-current border-t-transparent rounded-full animate-spin mr-2" />}
                    {children}
                </button>
            );
        };

        const Card = ({ children, className = "" }) => (
            <div className={`bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl shadow-sm overflow-hidden ${className}`}>{children}</div>
        );

        const Modal = ({ isOpen, onClose, title, children, maxWidth = "max-w-lg", footer }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-zinc-900/40 dark:bg-black/60 backdrop-blur-sm animate-fade-in p-4">
                    <div className={`bg-white dark:bg-zinc-900 rounded-xl shadow-2xl w-full ${maxWidth} overflow-hidden animate-slide-up border border-zinc-200 dark:border-zinc-800 max-h-[90vh] flex flex-col`}>
                        <div className="px-6 py-4 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-white dark:bg-zinc-900 sticky top-0 z-10">
                            <h3 className="font-semibold text-zinc-900 dark:text-zinc-100">{title}</h3>
                            <button onClick={onClose} className="text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300 p-1 rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-800"><Icon name="X" /></button>
                        </div>
                        <div className="p-6 overflow-y-auto flex-1 dark:text-zinc-300">{children}</div>
                        {footer && <div className="px-6 py-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-800/50 flex justify-end gap-2">{footer}</div>}
                    </div>
                </div>
            );
        };

        const Input = ({ label, help, className = "", ...props }) => (
            <div className={`space-y-1.5 ${className}`}>
                <label className="block text-xs font-medium text-zinc-700 dark:text-zinc-300">{label}</label>
                <input className="w-full px-3 py-2 bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-lg text-sm text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-zinc-900/10 dark:focus:ring-white/10 focus:border-zinc-400 dark:focus:border-zinc-600 transition-all placeholder:text-zinc-400 disabled:opacity-50 disabled:bg-zinc-50 dark:disabled:bg-zinc-900" {...props} />
                {help && <p className="text-[10px] text-zinc-500 dark:text-zinc-400">{help}</p>}
            </div>
        );

        const Toggle = ({ label, checked, onChange, help }) => (
            <label className="flex items-start gap-3 cursor-pointer group">
                <div className="relative inline-flex items-center mt-0.5">
                    <input type="checkbox" className="sr-only peer" checked={checked} onChange={(e) => onChange(e.target.checked)} />
                    <div className="w-9 h-5 bg-zinc-200 dark:bg-zinc-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-zinc-900/10 dark:peer-focus:ring-white/10 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white dark:peer-checked:after:border-zinc-900 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white dark:peer-checked:after:bg-zinc-900 after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-zinc-900 dark:peer-checked:bg-zinc-100 group-hover:bg-zinc-300 dark:group-hover:bg-zinc-600"></div>
                </div>
                <div>
                    <span className="text-sm font-medium text-zinc-900 dark:text-zinc-200 select-none">{label}</span>
                    {help && <p className="text-[10px] text-zinc-500 dark:text-zinc-400 mt-0.5 select-none">{help}</p>}
                </div>
            </label>
        );

        const ConfirmModal = ({ isOpen, onClose, onConfirm, title, message }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-zinc-900/40 dark:bg-black/60 backdrop-blur-sm animate-fade-in p-4">
                    <div className="bg-white dark:bg-zinc-900 rounded-xl shadow-2xl w-full max-w-sm overflow-hidden animate-slide-up border border-zinc-200 dark:border-zinc-800">
                        <div className="p-6">
                            <h3 className="font-semibold text-zinc-900 dark:text-zinc-100 mb-2">{title}</h3>
                            <p className="text-sm text-zinc-600 dark:text-zinc-400">{message}</p>
                        </div>
                        <div className="px-6 py-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-800/50 flex justify-end gap-2">
                            <Button variant="secondary" size="sm" onClick={onClose}>å–æ¶ˆ</Button>
                            <Button variant="danger" size="sm" onClick={onConfirm}>ç¡®å®š</Button>
                        </div>
                    </div>
                </div>
            );
        };

        // ==================== Quota Modal (æ­£ç¡®ç‰ˆæœ¬ï¼šæŒ‰æ¯ä¸ªæ¨¡å‹æ˜¾ç¤º) ====================
        const QuotaModal = ({ isOpen, onClose, token }) => {
            const [isRefreshing, setIsRefreshing] = useState(false);
            const [quotas, setQuotas] = useState(MOCK_QUOTA_MODELS);
            const { addToast } = useToast();

            if (!isOpen || !token) return null;

            const handleRefresh = () => {
                setIsRefreshing(true);
                setTimeout(() => {
                    setIsRefreshing(false);
                    addToast('é¢åº¦æ•°æ®å·²åˆ·æ–°', 'success');
                }, 1000);
            };

            // æŒ‰æ¨¡å‹ç±»å‹åˆ†ç»„
            const grouped = { claude: [], gemini: [], other: [] };
            Object.entries(quotas).forEach(([modelId, quota]) => {
                const item = { modelId, ...quota };
                if (modelId.toLowerCase().includes('claude')) grouped.claude.push(item);
                else if (modelId.toLowerCase().includes('gemini')) grouped.gemini.push(item);
                else grouped.other.push(item);
            });

            const getBarColor = (pct) => pct > 50 ? 'bg-zinc-800 dark:bg-zinc-200' : pct > 20 ? 'bg-amber-500' : 'bg-red-500';

            const renderGroup = (title, emoji, items) => {
                if (items.length === 0) return null;
                return (
                    <div className="mb-4">
                        <h4 className="text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2 flex items-center gap-1.5">
                            <span>{emoji}</span> {title}
                        </h4>
                        <div className="space-y-2">
                            {items.map(item => {
                                const pct = (item.remaining * 100).toFixed(1);
                                return (
                                    <div key={item.modelId} className="border border-zinc-100 dark:border-zinc-800 rounded-lg p-3 bg-zinc-50/30 dark:bg-zinc-800/30 hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors">
                                        <div className="flex justify-between items-center mb-1.5">
                                            <span className="text-sm font-medium text-zinc-900 dark:text-zinc-200">{item.modelId}</span>
                                            <div className="flex items-center text-[10px] text-zinc-500 dark:text-zinc-400 gap-1 bg-white dark:bg-zinc-800 px-1.5 py-0.5 rounded border border-zinc-100 dark:border-zinc-700">
                                                <Icon name="Clock" size={10} />
                                                <span className="font-mono">{item.resetTime}</span>
                                            </div>
                                        </div>
                                        <div className="h-2 w-full bg-zinc-100 dark:bg-zinc-700 rounded-full overflow-hidden border border-zinc-100 dark:border-zinc-700">
                                            <div className={`h-full rounded-full transition-all duration-500 ${getBarColor(pct)}`} style={{ width: `${pct}%` }}></div>
                                        </div>
                                        <div className="flex justify-between mt-1">
                                            <span className="text-[10px] text-zinc-400 dark:text-zinc-500">å‰©ä½™</span>
                                            <span className="text-[10px] font-medium text-zinc-700 dark:text-zinc-300">{pct}%</span>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            return (
                <Modal
                    isOpen={isOpen}
                    onClose={onClose}
                    title="é¢åº¦è¯¦æƒ…"
                    maxWidth="max-w-lg"
                    footer={<Button variant="secondary" size="sm" onClick={onClose}>å…³é—­</Button>}
                >
                    <div className="flex justify-between items-center mb-4">
                        <div className="text-xs text-zinc-500 dark:text-zinc-400 bg-zinc-50 dark:bg-zinc-800 px-2 py-1 rounded border border-zinc-100 dark:border-zinc-700">
                            <span className="font-medium text-zinc-700 dark:text-zinc-300">Project ID:</span> {token.projectId}
                        </div>
                        <button onClick={handleRefresh} className="text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 p-2 rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors" title="ç«‹å³åˆ·æ–°é¢åº¦">
                            <Icon name="RefreshCw" size={16} className={isRefreshing ? "animate-spin" : ""} />
                        </button>
                    </div>
                    {renderGroup('Claude æ¨¡å‹', 'ğŸ¤–', grouped.claude)}
                    {renderGroup('Gemini æ¨¡å‹', 'ğŸ’', grouped.gemini)}
                    {renderGroup('å…¶ä»–æ¨¡å‹', 'ğŸ”§', grouped.other)}
                </Modal>
            );
        };

        // ==================== Add Token Modal ====================
        const AddTokenModal = ({ isOpen, onClose, onAdd }) => {
            const [activeTab, setActiveTab] = useState('oauth');
            const [isLoading, setIsLoading] = useState(false);
            const [manualForm, setManualForm] = useState({ accessToken: '', refreshToken: '', expiresIn: '3599' });
            const [oauthUrl, setOauthUrl] = useState('');
            const { addToast } = useToast();

            const handleManualSubmit = (e) => {
                e.preventDefault();
                if (!manualForm.accessToken || !manualForm.refreshToken) {
                    addToast('è¯·å¡«å†™å®Œæ•´çš„Tokenä¿¡æ¯', 'warning');
                    return;
                }
                setIsLoading(true);
                setTimeout(() => {
                    onAdd({
                        refresh_token: manualForm.refreshToken || "1//Manual...Token",
                        access_token_suffix: "..." + (manualForm.accessToken.slice(-4) || 'new'),
                        projectId: "manual-project-id",
                        email: "manual@example.com",
                        enable: true,
                        expires_in: parseInt(manualForm.expiresIn) || 3599,
                        timestamp: Date.now()
                    });
                    addToast('Tokenæ·»åŠ æˆåŠŸï¼', 'success');
                    setIsLoading(false);
                    onClose();
                    setManualForm({ accessToken: '', refreshToken: '', expiresIn: '3599' });
                }, 800);
            };

            const handleOAuthSubmit = (e) => {
                e.preventDefault();
                if (!oauthUrl) {
                    addToast('è¯·è¾“å…¥å›è°ƒURL', 'warning');
                    return;
                }
                setIsLoading(true);
                setTimeout(() => {
                    onAdd({
                        refresh_token: "1//OAuth..." + Date.now(),
                        access_token_suffix: "...OAuth",
                        projectId: "oauth-project-auto",
                        email: "oauth@google.com",
                        enable: true,
                        expires_in: 3599,
                        timestamp: Date.now()
                    });
                    addToast('Tokenæ·»åŠ æˆåŠŸï¼', 'success');
                    setIsLoading(false);
                    onClose();
                    setOauthUrl('');
                }, 1000);
            };

            const openOAuthWindow = () => {
                const port = Math.floor(Math.random() * 10000) + 50000;
                const CLIENT_ID = '1071006060591-tmhssin2h21lcre235vtolojh4g403ep.apps.googleusercontent.com';
                const SCOPES = 'https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile';
                const redirectUri = `http://localhost:${port}/oauth-callback`;
                const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?access_type=offline&client_id=${CLIENT_ID}&prompt=consent&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=${encodeURIComponent(SCOPES)}&state=${Date.now()}`;
                window.open(authUrl, '_blank');
                addToast('è¯·åœ¨æ–°çª—å£å®Œæˆæˆæƒ', 'info');
            };

            return (
                <Modal isOpen={isOpen} onClose={onClose} title="æ·»åŠ  Token å‡­è¯">
                    <div className="flex border-b border-zinc-200 dark:border-zinc-800 mb-6">
                        <button className={`pb-2 px-4 text-sm font-medium transition-colors border-b-2 ${activeTab === 'oauth' ? 'text-zinc-900 dark:text-zinc-100 border-zinc-900 dark:border-zinc-100' : 'text-zinc-500 dark:text-zinc-400 border-transparent hover:text-zinc-700 dark:hover:text-zinc-300'}`} onClick={() => setActiveTab('oauth')}>OAuth è‡ªåŠ¨è·å–</button>
                        <button className={`pb-2 px-4 text-sm font-medium transition-colors border-b-2 ${activeTab === 'manual' ? 'text-zinc-900 dark:text-zinc-100 border-zinc-900 dark:border-zinc-100' : 'text-zinc-500 dark:text-zinc-400 border-transparent hover:text-zinc-700 dark:hover:text-zinc-300'}`} onClick={() => setActiveTab('manual')}>æ‰‹åŠ¨å¡«å…¥</button>
                    </div>
                    {activeTab === 'oauth' ? (
                        <div className="space-y-4 animate-fade-in">
                            <div className="bg-zinc-50 dark:bg-zinc-800 p-4 rounded-lg border border-zinc-100 dark:border-zinc-700 text-sm text-zinc-600 dark:text-zinc-300 space-y-2">
                                <p>1. ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‰“å¼€ Google æˆæƒé¡µé¢ã€‚</p>
                                <p>2. æˆæƒå®Œæˆåï¼Œå¤åˆ¶æµè§ˆå™¨åœ°å€æ çš„å®Œæ•´ URLã€‚</p>
                                <p>3. å°† URL ç²˜è´´åˆ°ä¸‹æ–¹è¾“å…¥æ¡†ã€‚</p>
                            </div>
                            <Button variant="secondary" className="w-full" onClick={openOAuthWindow}>
                                <Icon name="ExternalLink" size={16} className="mr-2" /> æ‰“å¼€æˆæƒé¡µé¢
                            </Button>
                            <form onSubmit={handleOAuthSubmit} className="space-y-4">
                                <Input label="å›è°ƒ URL" placeholder="http://localhost:xxxxx/oauth-callback?code=..." value={oauthUrl} onChange={e => setOauthUrl(e.target.value)} />
                                <Button className="w-full" isLoading={isLoading}>è§£æå¹¶æ·»åŠ </Button>
                            </form>
                        </div>
                    ) : (
                        <form onSubmit={handleManualSubmit} className="space-y-4 animate-fade-in">
                            <Input label="Access Token" placeholder="å¿…å¡«" value={manualForm.accessToken} onChange={e => setManualForm({ ...manualForm, accessToken: e.target.value })} />
                            <Input label="Refresh Token" placeholder="å¿…å¡«" value={manualForm.refreshToken} onChange={e => setManualForm({ ...manualForm, refreshToken: e.target.value })} />
                            <Input label="è¿‡æœŸæ—¶é—´ (ç§’)" type="number" value={manualForm.expiresIn} onChange={e => setManualForm({ ...manualForm, expiresIn: e.target.value })} help="é»˜è®¤ 3599 ç§’ï¼ˆçº¦1å°æ—¶ï¼‰" />
                            <Button className="w-full" isLoading={isLoading}>ä¿å­˜å‡­è¯</Button>
                        </form>
                    )}
                </Modal>
            );
        };

        // ==================== Dashboard (Token ç®¡ç†) ====================
        const Dashboard = () => {
            const [tokens, setTokens] = useState(INITIAL_TOKENS);
            const [isAddModalOpen, setIsAddModalOpen] = useState(false);
            const [quotaModalToken, setQuotaModalToken] = useState(null);
            const [confirmModal, setConfirmModal] = useState({ isOpen: false });
            const [isRefreshing, setIsRefreshing] = useState(false);
            const { addToast } = useToast();

            const handleToggle = (rt) => {
                const token = tokens.find(t => t.refresh_token === rt);
                const newEnable = !token.enable;
                setConfirmModal({
                    isOpen: true,
                    title: newEnable ? 'å¯ç”¨ç¡®è®¤' : 'ç¦ç”¨ç¡®è®¤',
                    message: `ç¡®å®šè¦${newEnable ? 'å¯ç”¨' : 'ç¦ç”¨'}è¿™ä¸ªTokenå—ï¼Ÿ`,
                    action: () => {
                        setTokens(tokens.map(t => t.refresh_token === rt ? { ...t, enable: newEnable } : t));
                        addToast(`Tokenå·²${newEnable ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'success');
                        setConfirmModal({ isOpen: false });
                    }
                });
            };

            const handleDelete = (rt) => {
                setConfirmModal({
                    isOpen: true,
                    title: 'âš ï¸ åˆ é™¤ç¡®è®¤',
                    message: 'åˆ é™¤åæ— æ³•æ¢å¤ï¼Œç¡®å®šè¦åˆ é™¤è¿™ä¸ªTokenå—ï¼Ÿ',
                    action: () => {
                        setTokens(tokens.filter(t => t.refresh_token !== rt));
                        addToast('Tokenå·²åˆ é™¤', 'success');
                        setConfirmModal({ isOpen: false });
                    }
                });
            };

            const handleRefresh = () => {
                setIsRefreshing(true);
                setTimeout(() => {
                    setIsRefreshing(false);
                    addToast('Tokenåˆ—è¡¨å·²åˆ·æ–°', 'success');
                }, 800);
            };

            const handleAdd = (newToken) => {
                setTokens([...tokens, newToken]);
            };

            return (
                <div className="p-6 md:p-8 max-w-6xl mx-auto w-full space-y-6 animate-fade-in">
                    {/* Stats */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <Card className="p-5 flex justify-between items-center">
                            <div><div className="text-zinc-500 dark:text-zinc-400 text-xs font-medium uppercase">æ€» Token æ•°</div><div className="text-2xl font-bold mt-1 text-zinc-900 dark:text-zinc-100">{tokens.length}</div></div>
                            <div className="bg-zinc-100 dark:bg-zinc-800 p-2 rounded-lg text-zinc-500 dark:text-zinc-400"><Icon name="LayoutGrid" /></div>
                        </Card>
                        <Card className="p-5 flex justify-between items-center border-l-4 border-emerald-500">
                            <div><div className="text-zinc-500 dark:text-zinc-400 text-xs font-medium uppercase">å·²å¯ç”¨</div><div className="text-2xl font-bold mt-1 text-zinc-900 dark:text-zinc-100">{tokens.filter(t => t.enable).length}</div></div>
                            <div className="bg-emerald-50 dark:bg-emerald-900/30 p-2 rounded-lg text-emerald-600 dark:text-emerald-400"><Icon name="Check" /></div>
                        </Card>
                        <Card className="p-5 flex justify-between items-center">
                            <div><div className="text-zinc-500 dark:text-zinc-400 text-xs font-medium uppercase">å·²ç¦ç”¨</div><div className="text-2xl font-bold mt-1 text-zinc-900 dark:text-zinc-100">{tokens.filter(t => !t.enable).length}</div></div>
                            <div className="bg-zinc-100 dark:bg-zinc-800 p-2 rounded-lg text-zinc-400 dark:text-zinc-500"><Icon name="X" /></div>
                        </Card>
                    </div>

                    {/* Actions */}
                    <div className="flex justify-between items-center">
                        <h2 className="text-lg font-semibold text-zinc-900 dark:text-zinc-100">å‡­è¯åˆ—è¡¨</h2>
                        <div className="flex gap-2">
                            <Button variant="secondary" onClick={handleRefresh} disabled={isRefreshing}>
                                <Icon name="RefreshCw" size={16} className={isRefreshing ? "animate-spin" : ""} />
                            </Button>
                            <Button onClick={() => setIsAddModalOpen(true)}><Icon name="Plus" size={16} className="mr-2" /> æ·»åŠ </Button>
                        </div>
                    </div>

                    {/* Token Table */}
                    <Card className="overflow-visible">
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm text-left">
                                <thead className="bg-zinc-50/50 dark:bg-zinc-800/50 border-b border-zinc-100 dark:border-zinc-800 text-zinc-500 dark:text-zinc-400">
                                    <tr>
                                        <th className="px-6 py-3 font-medium">è´¦å·ä¿¡æ¯ (Project ID)</th>
                                        <th className="px-6 py-3 font-medium">Token è¯¦æƒ…</th>
                                        <th className="px-6 py-3 font-medium text-center">çŠ¶æ€</th>
                                        <th className="px-6 py-3 font-medium text-center">æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-zinc-100">
                                    {tokens.length === 0 ? (
                                        <tr>
                                            <td colSpan="4" className="px-6 py-12 text-center text-zinc-400 dark:text-zinc-500">
                                                <div className="text-4xl mb-2">ğŸ“¦</div>
                                                <div>æš‚æ—  Tokenï¼Œç‚¹å‡»ä¸Šæ–¹ã€Œæ·»åŠ ã€æŒ‰é’®æ·»åŠ </div>
                                            </td>
                                        </tr>
                                    ) : tokens.map((token, idx) => (
                                        <tr key={idx} className="hover:bg-zinc-50/50 dark:hover:bg-zinc-800/20 transition-colors">
                                            <td className="px-6 py-4">
                                                <div className="font-medium text-zinc-900 dark:text-zinc-200">{token.projectId || 'N/A'}</div>
                                                <div className="text-xs text-zinc-500 dark:text-zinc-400">{token.email || "N/A"}</div>
                                            </td>
                                            <td className="px-6 py-4 text-xs font-mono text-zinc-500 dark:text-zinc-400">
                                                <div>Access: {token.access_token_suffix}</div>
                                                <div>Refresh: {token.refresh_token.substring(0, 8)}...</div>
                                            </td>
                                            <td className="px-6 py-4 text-center">
                                                <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${token.enable ? 'bg-emerald-50 text-emerald-700 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-400 dark:border-emerald-800' : 'bg-zinc-100 text-zinc-500 border-zinc-200 dark:bg-zinc-800 dark:text-zinc-400 dark:border-zinc-700'}`}>
                                                    <span className={`w-1.5 h-1.5 rounded-full mr-1.5 ${token.enable ? 'bg-emerald-500' : 'bg-zinc-400'}`}></span>
                                                    {token.enable ? 'å¯ç”¨' : 'ç¦ç”¨'}
                                                </span>
                                            </td>
                                            <td className="px-6 py-4">
                                                <div className="flex items-center justify-center gap-2">
                                                    <Button variant="secondary" size="sm" onClick={() => setQuotaModalToken(token)}>é¢åº¦</Button>
                                                    <Button variant={token.enable ? "secondary" : "primary"} size="sm" onClick={() => handleToggle(token.refresh_token)}>{token.enable ? "ç¦ç”¨" : "å¯ç”¨"}</Button>
                                                    <Button variant="danger" size="sm" onClick={() => handleDelete(token.refresh_token)}><Icon name="Trash2" size={14} /></Button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </Card>

                    {/* Modals */}
                    <AddTokenModal isOpen={isAddModalOpen} onClose={() => setIsAddModalOpen(false)} onAdd={handleAdd} />
                    <QuotaModal isOpen={!!quotaModalToken} token={quotaModalToken} onClose={() => setQuotaModalToken(null)} />
                    <ConfirmModal
                        isOpen={confirmModal.isOpen}
                        onClose={() => setConfirmModal({ isOpen: false })}
                        onConfirm={confirmModal.action}
                        title={confirmModal.title}
                        message={confirmModal.message}
                    />
                </div>
            );
        };

        // ==================== Settings (é…ç½®ç®¡ç†) ====================
        const Settings = () => {
            const [config, setConfig] = useState(INITIAL_CONFIG);
            const [isSaving, setIsSaving] = useState(false);
            const { addToast } = useToast();

            const handleSave = () => {
                setIsSaving(true);
                setTimeout(() => {
                    setIsSaving(false);
                    addToast('é…ç½®å·²ä¿å­˜å¹¶ç”Ÿæ•ˆï¼ˆç«¯å£/HOSTä¿®æ”¹éœ€é‡å¯ï¼‰', 'success');
                }, 1000);
            };

            return (
                <div className="p-6 md:p-8 max-w-4xl mx-auto space-y-8 animate-fade-in">
                    <div><h2 className="text-xl font-bold text-zinc-900 dark:text-zinc-100">ç³»ç»Ÿè®¾ç½®</h2><p className="text-sm text-zinc-500 dark:text-zinc-400">ä¿®æ”¹ config.json ä¸æœåŠ¡å™¨å‚æ•°</p></div>

                    <div className="space-y-8">
                        {/* Server Config */}
                        <section className="space-y-4">
                            <h3 className="text-sm font-semibold text-zinc-900 dark:text-zinc-100 border-b border-zinc-200 dark:border-zinc-800 pb-2 flex items-center gap-2"><Icon name="Zap" size={16} /> æœåŠ¡å™¨é…ç½® (Server)</h3>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <Input label="ç«¯å£ (Port)" type="number" value={config.port} onChange={e => setConfig({ ...config, port: e.target.value })} />
                                <Input label="Host" value={config.host} onChange={e => setConfig({ ...config, host: e.target.value })} />
                                <Input label="æœ€å¤§è¯·æ±‚å¤§å° (Max Request Size)" value={config.maxRequestSize} onChange={e => setConfig({ ...config, maxRequestSize: e.target.value })} />
                            </div>
                        </section>

                        {/* Model Defaults */}
                        <section className="space-y-4">
                            <h3 className="text-sm font-semibold text-zinc-900 dark:text-zinc-100 border-b border-zinc-200 dark:border-zinc-800 pb-2 flex items-center gap-2"><Icon name="Settings" size={16} /> æ¨¡å‹é»˜è®¤å‚æ•° (Defaults)</h3>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <Input label="Temperature" type="number" step="0.1" value={config.temp} onChange={e => setConfig({ ...config, temp: e.target.value })} />
                                <Input label="Top P" type="number" step="0.01" value={config.topP} onChange={e => setConfig({ ...config, topP: e.target.value })} />
                                <Input label="Top K" type="number" value={config.topK} onChange={e => setConfig({ ...config, topK: e.target.value })} />
                                <Input label="Max Tokens" type="number" value={config.maxTokens} onChange={e => setConfig({ ...config, maxTokens: e.target.value })} />
                            </div>
                        </section>

                        {/* Other */}
                        <section className="space-y-4">
                            <h3 className="text-sm font-semibold text-zinc-900 dark:text-zinc-100 border-b border-zinc-200 dark:border-zinc-800 pb-2 flex items-center gap-2"><Icon name="Settings" size={16} /> å…¶ä»–è®¾ç½® (Other)</h3>
                            <div className="bg-white dark:bg-zinc-900 p-4 rounded-lg border border-zinc-200 dark:border-zinc-800 space-y-4">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <Input label="è¯·æ±‚è¶…æ—¶æ—¶é—´ (Timeout ms)" type="number" value={config.timeout} onChange={e => setConfig({ ...config, timeout: e.target.value })} />
                                    <Input label="ä»£ç†åœ°å€ (Proxy)" value={config.proxy} onChange={e => setConfig({ ...config, proxy: e.target.value })} placeholder="http://127.0.0.1:7897" />
                                </div>
                                <div className="pt-2">
                                    <Toggle
                                        label="è·³è¿‡ ProjectId éªŒè¯ (Skip ProjectId Fetch)"
                                        checked={config.skipProjectIdFetch}
                                        onChange={(val) => setConfig({ ...config, skipProjectIdFetch: val })}
                                        help="å¼€å¯åå°†éšæœºç”Ÿæˆ Project IDï¼Œé€‚ç”¨äº Pro è´¦å·"
                                    />
                                </div>
                            </div>
                        </section>

                        {/* Security & System */}
                        <section className="space-y-4">
                            <h3 className="text-sm font-semibold text-zinc-900 dark:text-zinc-100 border-b border-zinc-200 dark:border-zinc-800 pb-2">å®‰å…¨ä¸ç¯å¢ƒå˜é‡ (Env / Security)</h3>
                            <div className="grid grid-cols-1 gap-4">
                                <Input label="API Key" type="text" value={config.apiKey} onChange={e => setConfig({ ...config, apiKey: e.target.value })} help="å®¢æˆ·ç«¯è°ƒç”¨ API æ—¶æ‰€éœ€çš„ Bearer Token" />
                                <div>
                                    <label className="block text-xs font-medium text-zinc-700 dark:text-zinc-300 mb-1.5">System Instruction</label>
                                    <textarea className="w-full px-3 py-2 bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-lg text-sm text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-zinc-900/10 dark:focus:ring-white/10 focus:border-zinc-400 dark:focus:border-zinc-600 transition-all resize-none placeholder:text-zinc-400" rows={3} value={config.systemInstruction} onChange={e => setConfig({ ...config, systemInstruction: e.target.value })} placeholder="è¾“å…¥ç³»ç»Ÿæç¤ºè¯..."></textarea>
                                </div>
                            </div>
                        </section>

                        <div className="pt-4 flex justify-end">
                            <Button size="lg" onClick={handleSave} isLoading={isSaving}>ä¿å­˜é…ç½®</Button>
                        </div>
                    </div>
                </div>
            );
        };

        // ==================== Login ====================
        const Login = ({ onLogin, darkMode, toggleDarkMode }) => {
            const [loading, setLoading] = useState(false);
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const { addToast } = useToast();

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!username || !password) {
                    addToast('è¯·å¡«å†™ç”¨æˆ·åå’Œå¯†ç ', 'warning');
                    return;
                }
                setLoading(true);
                setTimeout(() => {
                    if (username === 'admin' && password === 'admin123') {
                        addToast('ç™»å½•æˆåŠŸï¼', 'success');
                        onLogin();
                    } else {
                        addToast('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯', 'error');
                        setLoading(false);
                    }
                }, 800);
            };

            return (
                <div className="h-full flex items-center justify-center bg-zinc-50 dark:bg-zinc-950 p-4 transition-colors relative">
                    <div className="absolute top-4 right-4">
                        <button onClick={toggleDarkMode} className="p-2 rounded-lg bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 text-zinc-500 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors shadow-sm">
                            {darkMode ? <Icon name="Sun" size={20} /> : <Icon name="Moon" size={20} />}
                        </button>
                    </div>
                    <div className="w-full max-w-sm bg-white dark:bg-zinc-900 p-8 rounded-2xl shadow-xl border border-zinc-100 dark:border-zinc-800 animate-slide-up transition-colors">
                        <div className="flex justify-center mb-6"><div className="bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 p-3 rounded-xl"><Icon name="Zap" size={24} /></div></div>
                        <h1 className="text-xl font-bold text-center mb-1 text-zinc-900 dark:text-zinc-100">Antigravity Console</h1>
                        <p className="text-center text-zinc-500 dark:text-zinc-400 text-xs mb-8">ç®¡ç†å‘˜ç™»å½•</p>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <Input label="Username" placeholder="admin" value={username} onChange={e => setUsername(e.target.value)} />
                            <Input label="Password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" value={password} onChange={e => setPassword(e.target.value)} />
                            <Button className="w-full" size="lg" isLoading={loading}>ç™» å½•</Button>
                        </form>
                        <p className="text-xs text-zinc-400 dark:text-zinc-500 text-center mt-6">é»˜è®¤è´¦å·: admin / admin123</p>
                    </div>
                </div>
            );
        };

        // ==================== Main App ====================
        const App = () => {
            const [view, setView] = useState('login');
            const [showLogoutConfirm, setShowLogoutConfirm] = useState(false);
            const [darkMode, setDarkMode] = useState(() => {
                if (typeof localStorage !== 'undefined') {
                    return localStorage.getItem('darkMode') === 'true';
                }
                return false;
            });

            useEffect(() => {
                if (darkMode) {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('darkMode', 'true');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('darkMode', 'false');
                }
            }, [darkMode]);

            const toggleDarkMode = () => setDarkMode(!darkMode);

            if (view === 'login') return <Login onLogin={() => setView('dashboard')} darkMode={darkMode} toggleDarkMode={toggleDarkMode} />;

            return (
                <div className="flex h-full bg-zinc-50 dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 transition-colors duration-200">
                    {/* Sidebar */}
                    <aside className="w-64 bg-white dark:bg-zinc-900 border-r border-zinc-200 dark:border-zinc-800 hidden md:flex flex-col transition-colors duration-200">
                        <div className="h-16 flex items-center px-6 border-b border-zinc-100 dark:border-zinc-800 gap-2">
                            <div className="bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 p-1.5 rounded-md"><Icon name="Zap" size={16} /></div>
                            <span className="font-bold tracking-tight">Antigravity</span>
                        </div>
                        <nav className="flex-1 p-4 space-y-1">
                            <button onClick={() => setView('dashboard')} className={`w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${view === 'dashboard' ? 'bg-zinc-100 dark:bg-zinc-800' : 'text-zinc-500 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-800/50'}`}><Icon name="LayoutGrid" size={18} /> Token ç®¡ç†</button>
                            <button onClick={() => setView('settings')} className={`w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${view === 'settings' ? 'bg-zinc-100 dark:bg-zinc-800' : 'text-zinc-500 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-800/50'}`}><Icon name="Settings" size={18} /> ç³»ç»Ÿè®¾ç½®</button>
                        </nav>
                        <div className="p-4 border-t border-zinc-100 dark:border-zinc-800 space-y-2">
                            <button onClick={() => setDarkMode(!darkMode)} className="w-full flex items-center gap-2 px-3 py-2 text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-800/50 rounded-lg transition-colors">
                                {darkMode ? <Icon name="Sun" size={18} /> : <Icon name="Moon" size={18} />}
                                {darkMode ? 'åˆ‡æ¢äº®è‰²æ¨¡å¼' : 'åˆ‡æ¢æš—è‰²æ¨¡å¼'}
                            </button>
                            <button onClick={() => setShowLogoutConfirm(true)} className="w-full flex items-center gap-2 px-3 py-2 text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/10 rounded-lg transition-colors"><Icon name="LogOut" size={18} /> é€€å‡ºç™»å½•</button>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="flex-1 overflow-auto flex flex-col">
                        {/* Mobile Header */}
                        <div className="md:hidden h-14 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between px-4 shrink-0 z-10 transition-colors duration-200">
                            <div className="font-bold flex items-center gap-2"><Icon name="Zap" size={18} /> Antigravity</div>
                            <div className="flex items-center gap-2">
                                <button onClick={() => setDarkMode(!darkMode)} className="p-2 text-zinc-500 dark:text-zinc-400">
                                    {darkMode ? <Icon name="Sun" size={18} /> : <Icon name="Moon" size={18} />}
                                </button>
                                <button onClick={() => setView(view === 'dashboard' ? 'settings' : 'dashboard')}><Icon name="Settings" size={18} className="text-zinc-500 dark:text-zinc-400" /></button>
                            </div>
                        </div>
                        <div className="flex-1 overflow-y-auto">
                            {view === 'dashboard' && <Dashboard />}
                            {view === 'settings' && <Settings />}
                        </div>
                    </main>

                    {/* Logout Confirm */}
                    <ConfirmModal
                        isOpen={showLogoutConfirm}
                        onClose={() => setShowLogoutConfirm(false)}
                        onConfirm={() => { setView('login'); setShowLogoutConfirm(false); }}
                        title="é€€å‡ºç¡®è®¤"
                        message="ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ"
                    />
                </div >
            );
        };

        // ==================== Render ====================
        ReactDOM.createRoot(document.getElementById('root')).render(
            <ToastProvider>
                <App />
            </ToastProvider>
        );
    </script>
</body>

</html>